#!/usr/bin/env bash
# exit on error
set -o errexit

echo "ğŸ“¦ Installing dependencies..."
bundle install

echo "ğŸ—„ï¸  Checking database connection..."
if [ -z "$DATABASE_URL" ]; then
  echo "âš ï¸  DATABASE_URL not set, skipping migrations"
else
  # Temporarily disable errexit for migration attempt
  set +e
  echo "ğŸ—„ï¸  Running database migrations..."
  bundle exec rails db:migrate
  migration_status=$?
  set -e

  if [ $migration_status -eq 0 ]; then
    echo "âœ… Migrations completed successfully"
  else
    echo "âš ï¸  Migrations failed - database may not be ready yet"
    echo "âš ï¸  Continuing build anyway. You can run migrations manually later."
  fi
fi

echo "âœ… Build complete!"
